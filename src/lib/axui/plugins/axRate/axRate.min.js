class axRate{constructor(t,s){return this.targetDom=axIdToDom(t),this.options=axExtend({insName:"",half:!1,icon:"ax-iconfont ax-icon-star-f",count:5,multiplier:1,value:0,readonly:!1,popShow:!1,popTheme:"ad",popFormat:"<i stars></i>星,总分:<i value></i>",tipsShow:!1,tipsFormat:"<i stars></i>星,总分:<i value></i>",clearShow:!1,size:"",rendered:"",getValue:"",setValue:""},s,this.targetDom,this.constructor.name),this.handlers={},this.targetDom&&"INPUT"!=this.targetDom.nodeName?this.parent=this.targetDom:(this.parent=axAddElem("div",{class:"ax-rate"}),"INPUT"==this.targetDom.nodeName&&(this.hidden=this.targetDom,this.hidden.insertAdjacentElement("beforeBegin",this.parent),"hidden"!=this.hidden.type&&(this.hidden.style.display="none"))),this.value=0,this.stars=0,this.items=[],this.init(),this}init(){let t;axInstance.push(this,this.options.insName,"rate"),this.renderRate(),this.set(this.options.value),this.options.popShow&&(t=axAddElem("div",{class:"ax-rate-popcon"},this.options.popFormat),this.tooltip=new axTooltip(this.items[0].dom,{trigger:"none",theme:this.options.popTheme,content:t}),new axHover(this.ul,{enter:()=>{this.tooltip.popup.show()},leave:()=>{this.tooltip.popup.hide()},hold:this.tooltip.popup.targetDom})),this.options.readonly||(this.clear.onclick=(()=>{this.set(0)}),this.items.forEach(s=>{let i=s.dom,e=i.firstElementChild,l=this.items.filter(t=>t.id<s.id),a=this.items.filter(t=>t.id>s.id);this.options.popShow&&new axHover(i,{enter:()=>{this.tooltip.popup.updatePosition(i)}}),i.onmousemove=(h=>{let o=this.movePlace(h,i);l.forEach(t=>{t.dom.firstElementChild.classList.add("ax-full"),t.value=1}),"half"==o?(e.classList.remove("ax-full"),e.classList.add("ax-half")):"full"==o&&(e.classList.remove("ax-half"),e.classList.add("ax-full")),a.forEach(t=>{t.dom.firstElementChild.classList.remove("ax-half"),t.dom.firstElementChild.classList.remove("ax-full")}),this.options.popShow&&this.calculate(s,o,t),i.onclick=(()=>{s.value="half"==o?.5:"full"==o?1:0,this.calculate(s,o),this.options.tipsShow&&(this.tipsValue&&(this.tipsValue.innerHTML=this.value),this.tipsStars&&(this.tipsStars.innerHTML=this.stars)),this.options.getValue&&this.options.getValue.call(this,this.value,this.stars),this.handlers.hasOwnProperty("getValue")&&this.emit("getValue",this.value,this.stars)})})}),this.ul.onmouseleave=(()=>{this.set(this.value),this.options.setValue&&this.options.setValue.call(this,this.value,this.stars),this.handlers.hasOwnProperty("setValue")&&this.emit("setValue",this.value,this.stars)}))}set(t){t<=0&&(t=0),t>=this.options.multiplier*this.options.count&&(t=this.options.multiplier*this.options.count);let s=t/this.options.multiplier,i=Math.floor(s),e=s-i;if(this.options.half||(e=0),t)for(let t=0;t<=i-1;t++){let s=this.items[t].dom.firstElementChild;s.classList.remove("ax-half"),s.classList.add("ax-full"),this.items[t].value=1}else this.items.forEach(t=>{let s=t.dom.firstElementChild;s.classList.remove("ax-half"),s.classList.remove("ax-full"),t.value=0});if(this.stars=i,.5==e){let t=this.items[i].dom.firstElementChild;t.classList.remove("ax-full"),t.classList.add("ax-half"),this.items[i].value=.5,this.stars+=.5,i++}for(let t=i;t<this.items.length;t++){let s=this.items[t].dom.firstElementChild;s.classList.remove("ax-half"),s.classList.remove("ax-full"),this.items[t].value=0}this.value=t,this.tipsValue&&(this.tipsValue.innerHTML=t),this.tipsStars&&(this.tipsStars.innerHTML=this.stars),this.hidden&&(this.hidden.value=t)}get(t){let s={stars:this.stars,value:this.value,count:this.options.count,multiplier:this.options.multiplier};return s[t]}calculate(t,s,i){let e=this.items.filter(s=>s.id<t.id),l=e.length;"half"==s?l+=.5:"full"==s&&l++,i?(i.querySelector("[stars]").innerHTML=l,i.querySelector("[value]").innerHTML=this.options.multiplier*l):(this.value=this.options.multiplier*l,this.stars=l)}renderRate(){let t=document.createDocumentFragment(),s=`<i class="${this.options.icon}"></i>`,i=`<li class="ax-item">\n                            ${s.repeat(2)}\n                        </li>`;this.ul=axAddElem("ul"),this.tips=axAddElem("div",{class:"ax-tips"},this.options.tipsFormat),this.tipsStars=this.tips.querySelector("[stars]"),this.tipsValue=this.tips.querySelector("[value]"),this.clear=axAddElem("i",{class:"ax-iconfont ax-icon-close-o-f",clear:""}),this.options.clearShow&&t.appendChild(this.clear);for(let t=1;t<=this.options.count;t++){let s=axStrToDom(i),e={id:t,value:0,dom:s};this.items.push(e),this.ul.appendChild(s)}t.appendChild(this.ul),this.options.tipsShow&&t.appendChild(this.tips),this.options.size&&this.parent.setAttribute("size",this.options.size),this.parent.appendChild(t),this.options.rendered&&this.options.rendered.call(this),"rendered"in this.handlers&&this.emit("rendered","")}movePlace(t,s){if(!this.options.half)return"full";let i=s.getBoundingClientRect().left,e=s.getBoundingClientRect().right,l=(e-i)/2,a=i+~~l,h="full";return t.clientX<a&&(h="half"),h}on(t,s){return axAddPlan(t,s,this),this}emit(t,...s){axExePlan(t,this,...s)}off(t,s){return axDelPlan(t,s,this),this}}document.querySelectorAll("[axRate]").forEach(t=>{new axRate(t)});